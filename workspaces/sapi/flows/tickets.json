{
    "id": "get_tickets",
    "name": "Get tickets",
    "pipeline": [
        {
            "action": "start",
            "data": {},
            "id": "start",
            "next_action": "handle_auth"
        },
        {
            "id": "handle_auth",
            "action": "handle",
            "data": {
                "flow": "auth"
            },
            "next_action": "flow_var_servicenow"
        },
        {
            "id": "flow_var_servicenow",
            "action": "flow_var",
            "data": {
                "url": "${env.base_url}/api/now/table/sn_customerservice_case?sysparm_fields=sys_updated_on,first_response_time,assigned_on,impact,short_description,sys_created_on,closed_at,resolved_at,urgency,number",
                "auth": "${response.data.tokens}"
            },
            "next_action": "request_get_tickets"
        },
        {
            "id": "request_get_tickets",
            "action": "request",
            "data": {
                "url": "${flow.url}",
                "method": "GET",
                "headers": {
                    "Authorization": "Bearer ${flow.auth.access_token}"
                },
                "data": {},
                "next_action_success": "store_contract",
                "next_action_fail": "response_contracts_fail"
            },
            "next_action": "${pipeline.next_action}"
        },
        {
            "id": "store_contract",
            "action": "mongodb",
            "data": {
                "action": "insert_one",
                "collection": "teste",
                "data": "${response.data}"
            },
            "next_action": null
        },
        {
            "id": "response_contracts_success",
            "action": "response",
            "data": {
                "status": 200,
                "headers": {},
                "data": {
                    "result": "${response.data}"
                }
            },
            "next_action": null
        },
        {
            "id": "response_contracts_fail",
            "action": "response",
            "data": {
                "status": 400,
                "headers": {},
                "data": {
                    "msg": "Algo deu errado",
                    "data": "${response}"
                }
            },
            "next_action": null
        }
    ]
}